#!/bin/bash

# This script, auto-generated by '/home/steveri/tmpdir/pipegen.sh',
# builds our entire chip in directory /build/bigtest.n/full_chip
# where (n-1) is number of highest existing directory
# Usage: $0

# BIGTEST builds in directory /build/bigtest.n/full_chip
# where (n-1) is number of highest existing directory
function get_next_file {
    root=$1
    n=`ls $root.* |& egrep "^$root.[0-9]*" | sed "s/^$root.//" | sort -n | tail -1`
    if ! [ "$n" ]; then echo $root.0; else echo $root.$((n+1)); fi
}
build_dir=`get_next_file /build/bigtest`
echo Building in directory build_dir=/full_chip

# Designed to run on r7arm-aha using steveri garnet repo
garnet=/sim/steveri/soc/components/cgra/garnet

# FIXME/TODO shouldn't this be part of setup-buildkite.sh?
# Set up the target build directory e.g. '/build/gold.batch22'
source $garnet/mflowgen/bin/setup-buildkite.sh --dir $build_dir/full_chip

# make list || mflowgen run --design $garnet/mflowgen/full_chip
mflowgen run --design $garnet/mflowgen/full_chip

$garnet/mflowgen/bin/build_chip.sh
