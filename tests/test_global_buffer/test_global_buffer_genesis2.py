from global_buffer import global_buffer_genesis2
import glob
import os


def teardown_function():
    for item in glob.glob('genesis_*'):
        os.system(f"rm -r {item}")


def test_global_buffer_genesis2(capsys):
    argv = [
        "--num_banks", "32",
        "--bank_addr_width", "16",
        "--bank_data_width", "64",
        "--top_config_addr_width", "32",
        "--top_config_data_width", "32"
    ]
    global_buffer_genesis2.global_buffer_wrapper.main(argv=argv)
    out, _ = capsys.readouterr()
    assert out == f"""\
Running genesis cmd 'Genesis2.pl -parse -generate -top global_buffer_wrapper -input global_buffer/genesis/global_buffer_wrapper.svp -parameter global_buffer_wrapper.num_banks='32' -parameter global_buffer_wrapper.bank_addr_width='16' -parameter global_buffer_wrapper.bank_data_width='64' -parameter global_buffer_wrapper.top_config_addr_width='32' -parameter global_buffer_wrapper.top_config_data_width='32''
global_buffer_wrapper(clk: In(Clock), reset: In(AsyncReset), host_wr_en_bank_0: In(Bit), host_wr_data_bank_0: In(Bits[64]), host_wr_addr_bank_0: In(Bits[16]), host_rd_en_bank_0: In(Bit), host_rd_data_bank_0: Out(Bits[64]), host_rd_addr_bank_0: In(Bits[16]), cgra_wr_en_bank_0: In(Bit), cgra_wr_addr_bank_0: In(Bits[16]), cgra_wr_data_bank_0: In(Bits[64]), cgra_rd_en_bank_0: In(Bit), cgra_rd_addr_bank_0: In(Bits[16]), cgra_rd_data_bank_0: Out(Bits[64]), host_wr_en_bank_1: In(Bit), host_wr_data_bank_1: In(Bits[64]), host_wr_addr_bank_1: In(Bits[16]), host_rd_en_bank_1: In(Bit), host_rd_data_bank_1: Out(Bits[64]), host_rd_addr_bank_1: In(Bits[16]), cgra_wr_en_bank_1: In(Bit), cgra_wr_addr_bank_1: In(Bits[16]), cgra_wr_data_bank_1: In(Bits[64]), cgra_rd_en_bank_1: In(Bit), cgra_rd_addr_bank_1: In(Bits[16]), cgra_rd_data_bank_1: Out(Bits[64]), host_wr_en_bank_2: In(Bit), host_wr_data_bank_2: In(Bits[64]), host_wr_addr_bank_2: In(Bits[16]), host_rd_en_bank_2: In(Bit), host_rd_data_bank_2: Out(Bits[64]), host_rd_addr_bank_2: In(Bits[16]), cgra_wr_en_bank_2: In(Bit), cgra_wr_addr_bank_2: In(Bits[16]), cgra_wr_data_bank_2: In(Bits[64]), cgra_rd_en_bank_2: In(Bit), cgra_rd_addr_bank_2: In(Bits[16]), cgra_rd_data_bank_2: Out(Bits[64]), host_wr_en_bank_3: In(Bit), host_wr_data_bank_3: In(Bits[64]), host_wr_addr_bank_3: In(Bits[16]), host_rd_en_bank_3: In(Bit), host_rd_data_bank_3: Out(Bits[64]), host_rd_addr_bank_3: In(Bits[16]), cgra_wr_en_bank_3: In(Bit), cgra_wr_addr_bank_3: In(Bits[16]), cgra_wr_data_bank_3: In(Bits[64]), cgra_rd_en_bank_3: In(Bit), cgra_rd_addr_bank_3: In(Bits[16]), cgra_rd_data_bank_3: Out(Bits[64]), host_wr_en_bank_4: In(Bit), host_wr_data_bank_4: In(Bits[64]), host_wr_addr_bank_4: In(Bits[16]), host_rd_en_bank_4: In(Bit), host_rd_data_bank_4: Out(Bits[64]), host_rd_addr_bank_4: In(Bits[16]), cgra_wr_en_bank_4: In(Bit), cgra_wr_addr_bank_4: In(Bits[16]), cgra_wr_data_bank_4: In(Bits[64]), cgra_rd_en_bank_4: In(Bit), cgra_rd_addr_bank_4: In(Bits[16]), cgra_rd_data_bank_4: Out(Bits[64]), host_wr_en_bank_5: In(Bit), host_wr_data_bank_5: In(Bits[64]), host_wr_addr_bank_5: In(Bits[16]), host_rd_en_bank_5: In(Bit), host_rd_data_bank_5: Out(Bits[64]), host_rd_addr_bank_5: In(Bits[16]), cgra_wr_en_bank_5: In(Bit), cgra_wr_addr_bank_5: In(Bits[16]), cgra_wr_data_bank_5: In(Bits[64]), cgra_rd_en_bank_5: In(Bit), cgra_rd_addr_bank_5: In(Bits[16]), cgra_rd_data_bank_5: Out(Bits[64]), host_wr_en_bank_6: In(Bit), host_wr_data_bank_6: In(Bits[64]), host_wr_addr_bank_6: In(Bits[16]), host_rd_en_bank_6: In(Bit), host_rd_data_bank_6: Out(Bits[64]), host_rd_addr_bank_6: In(Bits[16]), cgra_wr_en_bank_6: In(Bit), cgra_wr_addr_bank_6: In(Bits[16]), cgra_wr_data_bank_6: In(Bits[64]), cgra_rd_en_bank_6: In(Bit), cgra_rd_addr_bank_6: In(Bits[16]), cgra_rd_data_bank_6: Out(Bits[64]), host_wr_en_bank_7: In(Bit), host_wr_data_bank_7: In(Bits[64]), host_wr_addr_bank_7: In(Bits[16]), host_rd_en_bank_7: In(Bit), host_rd_data_bank_7: Out(Bits[64]), host_rd_addr_bank_7: In(Bits[16]), cgra_wr_en_bank_7: In(Bit), cgra_wr_addr_bank_7: In(Bits[16]), cgra_wr_data_bank_7: In(Bits[64]), cgra_rd_en_bank_7: In(Bit), cgra_rd_addr_bank_7: In(Bits[16]), cgra_rd_data_bank_7: Out(Bits[64]), host_wr_en_bank_8: In(Bit), host_wr_data_bank_8: In(Bits[64]), host_wr_addr_bank_8: In(Bits[16]), host_rd_en_bank_8: In(Bit), host_rd_data_bank_8: Out(Bits[64]), host_rd_addr_bank_8: In(Bits[16]), cgra_wr_en_bank_8: In(Bit), cgra_wr_addr_bank_8: In(Bits[16]), cgra_wr_data_bank_8: In(Bits[64]), cgra_rd_en_bank_8: In(Bit), cgra_rd_addr_bank_8: In(Bits[16]), cgra_rd_data_bank_8: Out(Bits[64]), host_wr_en_bank_9: In(Bit), host_wr_data_bank_9: In(Bits[64]), host_wr_addr_bank_9: In(Bits[16]), host_rd_en_bank_9: In(Bit), host_rd_data_bank_9: Out(Bits[64]), host_rd_addr_bank_9: In(Bits[16]), cgra_wr_en_bank_9: In(Bit), cgra_wr_addr_bank_9: In(Bits[16]), cgra_wr_data_bank_9: In(Bits[64]), cgra_rd_en_bank_9: In(Bit), cgra_rd_addr_bank_9: In(Bits[16]), cgra_rd_data_bank_9: Out(Bits[64]), host_wr_en_bank_10: In(Bit), host_wr_data_bank_10: In(Bits[64]), host_wr_addr_bank_10: In(Bits[16]), host_rd_en_bank_10: In(Bit), host_rd_data_bank_10: Out(Bits[64]), host_rd_addr_bank_10: In(Bits[16]), cgra_wr_en_bank_10: In(Bit), cgra_wr_addr_bank_10: In(Bits[16]), cgra_wr_data_bank_10: In(Bits[64]), cgra_rd_en_bank_10: In(Bit), cgra_rd_addr_bank_10: In(Bits[16]), cgra_rd_data_bank_10: Out(Bits[64]), host_wr_en_bank_11: In(Bit), host_wr_data_bank_11: In(Bits[64]), host_wr_addr_bank_11: In(Bits[16]), host_rd_en_bank_11: In(Bit), host_rd_data_bank_11: Out(Bits[64]), host_rd_addr_bank_11: In(Bits[16]), cgra_wr_en_bank_11: In(Bit), cgra_wr_addr_bank_11: In(Bits[16]), cgra_wr_data_bank_11: In(Bits[64]), cgra_rd_en_bank_11: In(Bit), cgra_rd_addr_bank_11: In(Bits[16]), cgra_rd_data_bank_11: Out(Bits[64]), host_wr_en_bank_12: In(Bit), host_wr_data_bank_12: In(Bits[64]), host_wr_addr_bank_12: In(Bits[16]), host_rd_en_bank_12: In(Bit), host_rd_data_bank_12: Out(Bits[64]), host_rd_addr_bank_12: In(Bits[16]), cgra_wr_en_bank_12: In(Bit), cgra_wr_addr_bank_12: In(Bits[16]), cgra_wr_data_bank_12: In(Bits[64]), cgra_rd_en_bank_12: In(Bit), cgra_rd_addr_bank_12: In(Bits[16]), cgra_rd_data_bank_12: Out(Bits[64]), host_wr_en_bank_13: In(Bit), host_wr_data_bank_13: In(Bits[64]), host_wr_addr_bank_13: In(Bits[16]), host_rd_en_bank_13: In(Bit), host_rd_data_bank_13: Out(Bits[64]), host_rd_addr_bank_13: In(Bits[16]), cgra_wr_en_bank_13: In(Bit), cgra_wr_addr_bank_13: In(Bits[16]), cgra_wr_data_bank_13: In(Bits[64]), cgra_rd_en_bank_13: In(Bit), cgra_rd_addr_bank_13: In(Bits[16]), cgra_rd_data_bank_13: Out(Bits[64]), host_wr_en_bank_14: In(Bit), host_wr_data_bank_14: In(Bits[64]), host_wr_addr_bank_14: In(Bits[16]), host_rd_en_bank_14: In(Bit), host_rd_data_bank_14: Out(Bits[64]), host_rd_addr_bank_14: In(Bits[16]), cgra_wr_en_bank_14: In(Bit), cgra_wr_addr_bank_14: In(Bits[16]), cgra_wr_data_bank_14: In(Bits[64]), cgra_rd_en_bank_14: In(Bit), cgra_rd_addr_bank_14: In(Bits[16]), cgra_rd_data_bank_14: Out(Bits[64]), host_wr_en_bank_15: In(Bit), host_wr_data_bank_15: In(Bits[64]), host_wr_addr_bank_15: In(Bits[16]), host_rd_en_bank_15: In(Bit), host_rd_data_bank_15: Out(Bits[64]), host_rd_addr_bank_15: In(Bits[16]), cgra_wr_en_bank_15: In(Bit), cgra_wr_addr_bank_15: In(Bits[16]), cgra_wr_data_bank_15: In(Bits[64]), cgra_rd_en_bank_15: In(Bit), cgra_rd_addr_bank_15: In(Bits[16]), cgra_rd_data_bank_15: Out(Bits[64]), host_wr_en_bank_16: In(Bit), host_wr_data_bank_16: In(Bits[64]), host_wr_addr_bank_16: In(Bits[16]), host_rd_en_bank_16: In(Bit), host_rd_data_bank_16: Out(Bits[64]), host_rd_addr_bank_16: In(Bits[16]), cgra_wr_en_bank_16: In(Bit), cgra_wr_addr_bank_16: In(Bits[16]), cgra_wr_data_bank_16: In(Bits[64]), cgra_rd_en_bank_16: In(Bit), cgra_rd_addr_bank_16: In(Bits[16]), cgra_rd_data_bank_16: Out(Bits[64]), host_wr_en_bank_17: In(Bit), host_wr_data_bank_17: In(Bits[64]), host_wr_addr_bank_17: In(Bits[16]), host_rd_en_bank_17: In(Bit), host_rd_data_bank_17: Out(Bits[64]), host_rd_addr_bank_17: In(Bits[16]), cgra_wr_en_bank_17: In(Bit), cgra_wr_addr_bank_17: In(Bits[16]), cgra_wr_data_bank_17: In(Bits[64]), cgra_rd_en_bank_17: In(Bit), cgra_rd_addr_bank_17: In(Bits[16]), cgra_rd_data_bank_17: Out(Bits[64]), host_wr_en_bank_18: In(Bit), host_wr_data_bank_18: In(Bits[64]), host_wr_addr_bank_18: In(Bits[16]), host_rd_en_bank_18: In(Bit), host_rd_data_bank_18: Out(Bits[64]), host_rd_addr_bank_18: In(Bits[16]), cgra_wr_en_bank_18: In(Bit), cgra_wr_addr_bank_18: In(Bits[16]), cgra_wr_data_bank_18: In(Bits[64]), cgra_rd_en_bank_18: In(Bit), cgra_rd_addr_bank_18: In(Bits[16]), cgra_rd_data_bank_18: Out(Bits[64]), host_wr_en_bank_19: In(Bit), host_wr_data_bank_19: In(Bits[64]), host_wr_addr_bank_19: In(Bits[16]), host_rd_en_bank_19: In(Bit), host_rd_data_bank_19: Out(Bits[64]), host_rd_addr_bank_19: In(Bits[16]), cgra_wr_en_bank_19: In(Bit), cgra_wr_addr_bank_19: In(Bits[16]), cgra_wr_data_bank_19: In(Bits[64]), cgra_rd_en_bank_19: In(Bit), cgra_rd_addr_bank_19: In(Bits[16]), cgra_rd_data_bank_19: Out(Bits[64]), host_wr_en_bank_20: In(Bit), host_wr_data_bank_20: In(Bits[64]), host_wr_addr_bank_20: In(Bits[16]), host_rd_en_bank_20: In(Bit), host_rd_data_bank_20: Out(Bits[64]), host_rd_addr_bank_20: In(Bits[16]), cgra_wr_en_bank_20: In(Bit), cgra_wr_addr_bank_20: In(Bits[16]), cgra_wr_data_bank_20: In(Bits[64]), cgra_rd_en_bank_20: In(Bit), cgra_rd_addr_bank_20: In(Bits[16]), cgra_rd_data_bank_20: Out(Bits[64]), host_wr_en_bank_21: In(Bit), host_wr_data_bank_21: In(Bits[64]), host_wr_addr_bank_21: In(Bits[16]), host_rd_en_bank_21: In(Bit), host_rd_data_bank_21: Out(Bits[64]), host_rd_addr_bank_21: In(Bits[16]), cgra_wr_en_bank_21: In(Bit), cgra_wr_addr_bank_21: In(Bits[16]), cgra_wr_data_bank_21: In(Bits[64]), cgra_rd_en_bank_21: In(Bit), cgra_rd_addr_bank_21: In(Bits[16]), cgra_rd_data_bank_21: Out(Bits[64]), host_wr_en_bank_22: In(Bit), host_wr_data_bank_22: In(Bits[64]), host_wr_addr_bank_22: In(Bits[16]), host_rd_en_bank_22: In(Bit), host_rd_data_bank_22: Out(Bits[64]), host_rd_addr_bank_22: In(Bits[16]), cgra_wr_en_bank_22: In(Bit), cgra_wr_addr_bank_22: In(Bits[16]), cgra_wr_data_bank_22: In(Bits[64]), cgra_rd_en_bank_22: In(Bit), cgra_rd_addr_bank_22: In(Bits[16]), cgra_rd_data_bank_22: Out(Bits[64]), host_wr_en_bank_23: In(Bit), host_wr_data_bank_23: In(Bits[64]), host_wr_addr_bank_23: In(Bits[16]), host_rd_en_bank_23: In(Bit), host_rd_data_bank_23: Out(Bits[64]), host_rd_addr_bank_23: In(Bits[16]), cgra_wr_en_bank_23: In(Bit), cgra_wr_addr_bank_23: In(Bits[16]), cgra_wr_data_bank_23: In(Bits[64]), cgra_rd_en_bank_23: In(Bit), cgra_rd_addr_bank_23: In(Bits[16]), cgra_rd_data_bank_23: Out(Bits[64]), host_wr_en_bank_24: In(Bit), host_wr_data_bank_24: In(Bits[64]), host_wr_addr_bank_24: In(Bits[16]), host_rd_en_bank_24: In(Bit), host_rd_data_bank_24: Out(Bits[64]), host_rd_addr_bank_24: In(Bits[16]), cgra_wr_en_bank_24: In(Bit), cgra_wr_addr_bank_24: In(Bits[16]), cgra_wr_data_bank_24: In(Bits[64]), cgra_rd_en_bank_24: In(Bit), cgra_rd_addr_bank_24: In(Bits[16]), cgra_rd_data_bank_24: Out(Bits[64]), host_wr_en_bank_25: In(Bit), host_wr_data_bank_25: In(Bits[64]), host_wr_addr_bank_25: In(Bits[16]), host_rd_en_bank_25: In(Bit), host_rd_data_bank_25: Out(Bits[64]), host_rd_addr_bank_25: In(Bits[16]), cgra_wr_en_bank_25: In(Bit), cgra_wr_addr_bank_25: In(Bits[16]), cgra_wr_data_bank_25: In(Bits[64]), cgra_rd_en_bank_25: In(Bit), cgra_rd_addr_bank_25: In(Bits[16]), cgra_rd_data_bank_25: Out(Bits[64]), host_wr_en_bank_26: In(Bit), host_wr_data_bank_26: In(Bits[64]), host_wr_addr_bank_26: In(Bits[16]), host_rd_en_bank_26: In(Bit), host_rd_data_bank_26: Out(Bits[64]), host_rd_addr_bank_26: In(Bits[16]), cgra_wr_en_bank_26: In(Bit), cgra_wr_addr_bank_26: In(Bits[16]), cgra_wr_data_bank_26: In(Bits[64]), cgra_rd_en_bank_26: In(Bit), cgra_rd_addr_bank_26: In(Bits[16]), cgra_rd_data_bank_26: Out(Bits[64]), host_wr_en_bank_27: In(Bit), host_wr_data_bank_27: In(Bits[64]), host_wr_addr_bank_27: In(Bits[16]), host_rd_en_bank_27: In(Bit), host_rd_data_bank_27: Out(Bits[64]), host_rd_addr_bank_27: In(Bits[16]), cgra_wr_en_bank_27: In(Bit), cgra_wr_addr_bank_27: In(Bits[16]), cgra_wr_data_bank_27: In(Bits[64]), cgra_rd_en_bank_27: In(Bit), cgra_rd_addr_bank_27: In(Bits[16]), cgra_rd_data_bank_27: Out(Bits[64]), host_wr_en_bank_28: In(Bit), host_wr_data_bank_28: In(Bits[64]), host_wr_addr_bank_28: In(Bits[16]), host_rd_en_bank_28: In(Bit), host_rd_data_bank_28: Out(Bits[64]), host_rd_addr_bank_28: In(Bits[16]), cgra_wr_en_bank_28: In(Bit), cgra_wr_addr_bank_28: In(Bits[16]), cgra_wr_data_bank_28: In(Bits[64]), cgra_rd_en_bank_28: In(Bit), cgra_rd_addr_bank_28: In(Bits[16]), cgra_rd_data_bank_28: Out(Bits[64]), host_wr_en_bank_29: In(Bit), host_wr_data_bank_29: In(Bits[64]), host_wr_addr_bank_29: In(Bits[16]), host_rd_en_bank_29: In(Bit), host_rd_data_bank_29: Out(Bits[64]), host_rd_addr_bank_29: In(Bits[16]), cgra_wr_en_bank_29: In(Bit), cgra_wr_addr_bank_29: In(Bits[16]), cgra_wr_data_bank_29: In(Bits[64]), cgra_rd_en_bank_29: In(Bit), cgra_rd_addr_bank_29: In(Bits[16]), cgra_rd_data_bank_29: Out(Bits[64]), host_wr_en_bank_30: In(Bit), host_wr_data_bank_30: In(Bits[64]), host_wr_addr_bank_30: In(Bits[16]), host_rd_en_bank_30: In(Bit), host_rd_data_bank_30: Out(Bits[64]), host_rd_addr_bank_30: In(Bits[16]), cgra_wr_en_bank_30: In(Bit), cgra_wr_addr_bank_30: In(Bits[16]), cgra_wr_data_bank_30: In(Bits[64]), cgra_rd_en_bank_30: In(Bit), cgra_rd_addr_bank_30: In(Bits[16]), cgra_rd_data_bank_30: Out(Bits[64]), host_wr_en_bank_31: In(Bit), host_wr_data_bank_31: In(Bits[64]), host_wr_addr_bank_31: In(Bits[16]), host_rd_en_bank_31: In(Bit), host_rd_data_bank_31: Out(Bits[64]), host_rd_addr_bank_31: In(Bits[16]), cgra_wr_en_bank_31: In(Bit), cgra_wr_addr_bank_31: In(Bits[16]), cgra_wr_data_bank_31: In(Bits[64]), cgra_rd_en_bank_31: In(Bit), cgra_rd_addr_bank_31: In(Bits[16]), cgra_rd_data_bank_31: Out(Bits[64]), top_config_en_glb: In(Bit), top_config_wr: In(Bit), top_config_rd: In(Bit), top_config_addr: In(Bits[32]), top_config_wr_data: In(Bits[32]), top_config_rd_data: Out(Bits[32]))
"""  # nopep8
