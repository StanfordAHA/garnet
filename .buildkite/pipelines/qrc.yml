# To test QRC robustness, uses helper script qrc.sh to do ten
# consecutive postroute_hold runs, two at a time; this test
# takes about five hours for each run pair, so about 25 hours
# for the entire test.

agents: { queue: "papers" }

env:
  DESTDIR : /build/qtry${BUILDKITE_BUILD_NUMBER}

steps:
- label:    'qrc0'
  commands: 
  - '
    echo foo;
    echo fi;
    exit 13
  '
  - 'echo b1=$$BUILDKITE_COMMAND_EXIT_STATUS; echo b2=$BUILDKITE_COMMAND_EXIT_STATUS'


- wait:     { continue_on_failure: true }

- label:    'qrc1'
  commands: 'echo b1=$$BUILDKITE_COMMAND_EXIT_STATUS; echo b2=$BUILDKITE_COMMAND_EXIT_STATUS'



# - label:    'qrc1'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-1'
# - wait:     { continue_on_failure: true }
# 















# steps:
# - label:    'qrc0'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-0'
# - label:    'qrc1'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-1'
# - wait:     { continue_on_failure: true }
# 
# 
# - label:    'qrc2'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-2'
# - label:    'qrc3'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-3'
# - wait:     { continue_on_failure: true }
# 
# 
# - label:    'qrc4'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-4'
# - label:    'qrc5'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-5'
# - wait:     { continue_on_failure: true }
# 
# 
# - label:    'qrc6'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-6'
# - label:    'qrc7'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-7'
# - wait:     { continue_on_failure: true }
# 
# 
# - label:    'qrc8'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-8'
# - label:    'qrc9'
#   commands: '.buildkite/bin/qrc.sh $${DESTDIR}-9'
# - wait:     { continue_on_failure: true }
# 
# 
# ########################################################################
# # Builds this data structure...?
# # {
# #  'agents' : { 'queue' : 'papers' },
# #  'env'    : { 'DESTDIR' : '/build/qtry3456' },
# #  'steps'  : [ 
# #               { 'label' : 'qrc0' , 'commands' : 'qrc.sh' },
# #               { 'label' : 'qrc1' , 'commands' : 'qrc.sh' },
# #               { 'wait'  : { 'cf' : 'true' } }
# #             ]
# # }
